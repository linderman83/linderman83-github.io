<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Serve Next-Gen (.webp) images with Wordpress, no plugins - manual guide | CoodingBox</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" size="180x180" href="https://www.coodingbox.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" size="32x32" href="https://www.coodingbox.com/favicon-32x32.png">
    <link rel="icon" type="image/png" size="16x16" href="https://www.coodingbox.com/favicon-16x16.png">
    <link rel="icon" type="image/x-icon" href="https://www.coodingbox.com/favicon.ico">
    <link rel="stylesheet" type="text/css" href="https://www.coodingbox.com/css/cookieconsent.min.css">
    <script>
      var script = document.createElement("script");
      script.src = "https://www.googletagmanager.com/gtag/js?id=G-DZBP8YNTT9";
      script.async = true
      document.head.appendChild(script);

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DZBP8YNTT9');
    </script>
    <script id="cookieconsentMin">
      (function() { 
        var script = document.createElement("script"); 
        script.onload = () => {
          cookieStart()
        }
        script.src = "https://www.coodingbox.com/js/cookieconsent.min.js";
        setTimeout(() => { 
          document.body.append(script); 
        })
      })(); 
    </script>
    <script id="cookieconsentJs">
        function cookieStart() { 
          window.cookieconsent.initialise({
            container: document.getElementById("vuepress-theme-blog__global-layout"),
            palette: {
                popup: {
                    background: "#eaecef",
                    text: "#2c3e50"
                },
                button: {
                    background: "#3e7dda",
                    text: "#ffffff"
                },
            },
            content: {
                header: 'Cookies used on the website!',
                message: 'This website uses cookies to analyse traffic using Google Analytics. By clicking “Accept”, you consent to the use of all the cookies.',
                dismiss: 'Accept!',
                allow: 'Allow cookies',
                deny: 'Decline',
                link: 'Privary Policy',
                href: '/privacy-policy',
                close: '&#x274c;'
            },
            revokable: true,
            onStatusChange: function (status) {},
            law: {
                regionalLaw: false,
            },
            location: false,
          });
        }; 
    </script>
    <link rel="alternate" type="application/rss+xml" href="https://www.coodingbox.com/rss.xml" title="CoodingBox RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://www.coodingbox.com/feed.atom" title="CoodingBox Atom Feed">
    <link rel="alternate" type="application/json" href="https://www.coodingbox.com/feed.json" title="CoodingBox JSON Feed"><script type='application/ld+json'>
          {
            "@context": "https://schema.org",
            "@type": "Article",
            "headline": "Serve Next-Gen (.webp) images with Wordpress, no plugins - manual guide",
            "url": "https://coodingbox.com/wordpress-serve-webp-nextgen-image-formats-manual-guide/",
            "image": [
              ""
              ],
            "datePublished": "2023-11-21T00:00:00.000Z",
            "dateModified": "2023-11-21T00:00:00.000Z",
            "author": [{
                "@type": "Person",
                "name": "G.Kyu",
                "url": "https://coodingbox.com"
            }]
          }
      </script>
    <meta name="description" content="How to make Wordpress serve next-gen image formats (webp) manually, no plugins.">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="/wordpress-serve-webp-nextgen-image-formats-manual-guide/" rel="canonical" />
    <link rel="preload" href="/assets/css/0.styles.8d2f01ce.css" as="style"><link rel="preload" href="/assets/js/app.29683b52.js" as="script"><link rel="preload" href="/assets/js/10.6cbd15cf.js" as="script"><link rel="preload" href="/assets/js/8.74375672.js" as="script"><link rel="preload" href="/assets/js/21.085a020c.js" as="script"><link rel="preload" href="/assets/js/5.afebdb78.js" as="script"><link rel="prefetch" href="/assets/js/1.a18762af.js"><link rel="prefetch" href="/assets/js/11.86fcd4e2.js"><link rel="prefetch" href="/assets/js/12.86308382.js"><link rel="prefetch" href="/assets/js/13.01e8dd08.js"><link rel="prefetch" href="/assets/js/14.59115d40.js"><link rel="prefetch" href="/assets/js/15.12f4d5f2.js"><link rel="prefetch" href="/assets/js/16.c11491a2.js"><link rel="prefetch" href="/assets/js/17.6d3d31c2.js"><link rel="prefetch" href="/assets/js/18.3f25c036.js"><link rel="prefetch" href="/assets/js/19.78310268.js"><link rel="prefetch" href="/assets/js/20.7237d83c.js"><link rel="prefetch" href="/assets/js/4.98b44b33.js"><link rel="prefetch" href="/assets/js/6.3fa2bed0.js"><link rel="prefetch" href="/assets/js/7.61f75fe2.js"><link rel="prefetch" href="/assets/js/9.b37896e2.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.bb397414.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8d2f01ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link"><img alt="CoodingBox" src="https://www.coodingbox.com/images/coodingbox_logo.png"></a></div> <div class="header-right-wrap"><ul class="nav"></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">CoodingBox </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Serve Next-Gen (.webp) images with Wordpress, no plugins - manual guide
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2023-11-21T00:00:00.000Z">
      Tue Nov 21 2023
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/wordpress" data-v-42ccfcd5><span data-v-42ccfcd5>wordpress</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/webp" data-v-42ccfcd5><span data-v-42ccfcd5>webp</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/linux" data-v-42ccfcd5><span data-v-42ccfcd5>linux</span></a></li></ul></div></header> <!----> <div itemprop="articleBody" class="content__default"><p>I hope you already know what next-get image formats are why they are they beneficial for SEO. In this article i will try to put small guide on how to make/convert your current Wordpress site images to webp, manually, no plugins involved.</p> <p>To read more about webp image format: <a href="/image-optimization-using-jpegoptim-and-the-new-webp/">link</a></p> <p>Main goal here for us is to understand better how Wordpress works on deeper level and how is the database structured.</p> <p>Although this method is completely possible and works, it requires more serious technical knowledge and is not for everyone.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This method is for research and educational purposes.</p> <p>Its prone to error and not suitable for production websites.</p> <p>WP database is changed in the process!</p> <p>Be extra careful and decide if you want to take this path for your self!</p></div> <div class="custom-block tip"><p class="custom-block-title">Requirements:</p> <ul><li>Access to the database</li> <li>Access to Wordpress files (/wp-content/uploads)</li> <li>Access to Nginx / Apache configs (optional)</li></ul></div> <p>Let's go.</p> <h3 id="_1-first-of-all-make-backup-of-the-whole-wp-content-folder-and-the-database"><a href="#_1-first-of-all-make-backup-of-the-whole-wp-content-folder-and-the-database" class="header-anchor">#</a> 1. First of all - make backup of the whole <code>/wp-content</code> folder and the database!</h3> <h3 id="_2-convert-original-images-with-a-tool-of-choice"><a href="#_2-convert-original-images-with-a-tool-of-choice" class="header-anchor">#</a> 2. Convert original images with a tool of choice.</h3> <p>Choose the best way that serves to you and convert the images in <code>[wp-root]/wp-content/uploads</code> folder.
Me personaly, i made simple bash script to do it. If you interested, you can check it below:</p> <div class="custom-block details"><p class="custom-block-title">The script</p> <p>Download and save locally the precompiled webp binaries from:
<a href="https://developers.google.com/speed/webp/docs/precompiled" target="_blank" rel="noopener noreferrer">https://developers.google.com/speed/webp/docs/precompiled<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>In the code, you see my download is located at Downloads/Software</p> <p>Usage:</p> <div class="language- extra-class"><pre class="language-text"><code>./the_script -l /path_to_images_folder -e jpg|png|gif
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># Colors</span>
<span class="token assign-left variable">RED</span><span class="token operator">=</span><span class="token string">'\033[0;31m'</span>
<span class="token assign-left variable">GREEN</span><span class="token operator">=</span><span class="token string">'\033[0;32m'</span>
<span class="token assign-left variable">BLUE</span><span class="token operator">=</span><span class="token string">'\033[0;34m'</span>
<span class="token assign-left variable">YELLOW</span><span class="token operator">=</span><span class="token string">'\033[1;33m'</span>
<span class="token assign-left variable">NC</span><span class="token operator">=</span><span class="token string">'\033[0m'</span>

<span class="token assign-left variable">location</span><span class="token operator">=</span><span class="token string">''</span>
<span class="token assign-left variable">extension</span><span class="token operator">=</span><span class="token string">'jpg'</span>

<span class="token keyword">while</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$#</span> -gt <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
    -l<span class="token operator">|</span>--location<span class="token punctuation">)</span>
      <span class="token assign-left variable">location</span><span class="token operator">=</span><span class="token variable">$2</span>
      <span class="token builtin class-name">shift</span>
      <span class="token builtin class-name">shift</span>
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
    -e<span class="token operator">|</span>--extension<span class="token punctuation">)</span>
      <span class="token assign-left variable">extension</span><span class="token operator">=</span><span class="token variable">$2</span>
      <span class="token builtin class-name">shift</span>
      <span class="token builtin class-name">shift</span>
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
    -*<span class="token operator">|</span>--*<span class="token punctuation">)</span>
      <span class="token builtin class-name">echo</span> <span class="token string">&quot;Unknown option <span class="token variable">$1</span>&quot;</span>
      <span class="token builtin class-name">exit</span> <span class="token number">1</span>
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">esac</span>
<span class="token keyword">done</span>

<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">$'<span class="token entity" title="\n">\n</span>'</span>

<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">$LD_LIBRARY_PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/Downloads/Software/libwebp-1.3.2-linux-x86-64/lib

<span class="token assign-left variable">cwebp</span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/Downloads/Software/libwebp-1.3.2-linux-x86-64/bin/cwebp
<span class="token assign-left variable">options</span><span class="token operator">=</span><span class="token string">'-alpha_q 0 -m 6 -qrange 35 60 -sns 100 -quiet'</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$extension</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;gif&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">cwebp</span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/Downloads/Software/libwebp-1.3.2-linux-x86-64/bin/gif2webp
    <span class="token assign-left variable">options</span><span class="token operator">=</span><span class="token string">'-metadata all -quiet'</span>
<span class="token keyword">fi</span>

<span class="token function">touch</span> originals <span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">&gt;</span> originals
<span class="token function">touch</span> optimized <span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">&gt;</span> optimized

<span class="token assign-left variable">files</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">find</span> <span class="token string">&quot;<span class="token variable">$location</span>&quot;</span> -iname <span class="token string">&quot;*.&quot;</span>$extension<span class="token string">&quot;&quot;</span><span class="token variable">`</span></span>

<span class="token assign-left variable">original_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$files</span>&quot;</span> <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">`</span></span>

<span class="token builtin class-name">printf</span> <span class="token string">&quot;Files count: <span class="token variable">${original_count}</span> <span class="token entity" title="\n">\n</span>&quot;</span>

<span class="token assign-left variable">optimized_count</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token builtin class-name">printf</span> <span class="token string">&quot;Location size is: <span class="token variable">${RED}</span><span class="token variable"><span class="token variable">$(</span><span class="token function">du</span> -sh <span class="token string">&quot;<span class="token variable">$location</span>&quot;</span><span class="token variable">)</span></span><span class="token variable">${NC}</span> <span class="token entity" title="\n">\n</span>&quot;</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">$files</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token punctuation">[</span><span class="token string">&quot;<span class="token variable">$file</span>&quot;</span><span class="token punctuation">]</span> <span class="token variable"><span class="token variable">`</span><span class="token function">du</span> -b <span class="token string">&quot;<span class="token variable">$file</span>&quot;</span> <span class="token operator">|</span> <span class="token function">cut</span> -f1<span class="token variable">`</span></span> <span class="token operator">&gt;&gt;</span> originals
    
    <span class="token assign-left variable">filename</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> -- <span class="token string">&quot;<span class="token variable">$file</span>&quot;</span><span class="token variable">)</span></span>
    <span class="token assign-left variable">dirname</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${file<span class="token operator">/</span>$filename<span class="token operator">/</span>}</span>&quot;</span>
    <span class="token assign-left variable">extension</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${file<span class="token operator">##</span>*.}</span>&quot;</span>
    <span class="token assign-left variable">newfile</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$dirname</span><span class="token variable">${filename<span class="token operator">%</span>.*}</span>.webp&quot;</span>

    <span class="token builtin class-name">eval</span> <span class="token string">&quot;<span class="token variable">$cwebp</span> <span class="token variable">$options</span> '<span class="token variable">${file}</span>' -o '<span class="token variable">${newfile}</span>'&quot;</span> 

    <span class="token builtin class-name">echo</span> <span class="token punctuation">[</span><span class="token string">&quot;<span class="token variable">$newfile</span>&quot;</span><span class="token punctuation">]</span> <span class="token variable"><span class="token variable">`</span><span class="token function">du</span> -b <span class="token string">&quot;<span class="token variable">${newfile}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">cut</span> -f1<span class="token variable">`</span></span> <span class="token operator">&gt;&gt;</span> optimized

    <span class="token comment"># Dont delete original files</span>
    <span class="token comment"># rm -f &quot;${file}&quot;</span>

    <span class="token assign-left variable">optimized_count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> optimized_count <span class="token operator">+</span> <span class="token number">1</span> <span class="token variable">))</span></span>

    <span class="token builtin class-name">printf</span> <span class="token string">&quot;Done: <span class="token variable">${optimized_count}</span> <span class="token entity" title="\r">\r</span>&quot;</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">printf</span> <span class="token string">&quot;Optimized: <span class="token variable">${optimized_count}</span> <span class="token entity" title="\n">\n</span>&quot;</span>

<span class="token assign-left variable">original_size</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token keyword">while</span> <span class="token builtin class-name">read</span> line 
<span class="token keyword">do</span>
    <span class="token assign-left variable">line_size</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $line <span class="token operator">|</span> <span class="token function">sed</span> -n <span class="token string">&quot;s/^.* \([0-9]*\)$/<span class="token entity" title="\1">\1</span>/p&quot;</span><span class="token variable">`</span></span>
    <span class="token assign-left variable">original_size</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> original_size <span class="token operator">+</span> line_size <span class="token variable">))</span></span>
done<span class="token operator">&lt;</span>originals

<span class="token builtin class-name">printf</span> <span class="token string">&quot;Total size ORIGINALS: <span class="token variable">${RED}</span><span class="token variable">$original_size</span><span class="token variable">${NC}</span> <span class="token entity" title="\n">\n</span>&quot;</span>

<span class="token assign-left variable">optimized_size</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token keyword">while</span> <span class="token builtin class-name">read</span> line 
<span class="token keyword">do</span>
    <span class="token assign-left variable">line_size</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $line <span class="token operator">|</span> <span class="token function">sed</span> -n <span class="token string">&quot;s/^.* \([0-9]*\)$/<span class="token entity" title="\1">\1</span>/p&quot;</span><span class="token variable">`</span></span>
    <span class="token assign-left variable">optimized_size</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> optimized_size <span class="token operator">+</span> line_size <span class="token variable">))</span></span>
done<span class="token operator">&lt;</span>optimized

<span class="token builtin class-name">printf</span> <span class="token string">&quot;Total size OPTIMIZED: <span class="token variable">${YELLOW}</span><span class="token variable">${optimized_size}</span><span class="token variable">${NC}</span><span class="token entity" title="\n">\n</span>&quot;</span>

<span class="token builtin class-name">printf</span> <span class="token string">&quot;New Location size is: <span class="token variable">${GREEN}</span><span class="token variable"><span class="token variable">$(</span><span class="token function">du</span> -sh <span class="token string">&quot;<span class="token variable">$location</span>&quot;</span><span class="token variable">)</span></span><span class="token variable">${NC}</span><span class="token entity" title="\n">\n</span>&quot;</span>

<span class="token builtin class-name">printf</span> <span class="token string">&quot;<span class="token variable">${GREEN}</span>You saved <span class="token variable"><span class="token variable">$((</span> original_size <span class="token operator">-</span> optimized_size <span class="token variable">))</span></span> bytes<span class="token variable">${NC}</span><span class="token entity" title="\n">\n</span>&quot;</span>

</code></pre></div><p>Feel yourself free to use or change the code as you wish.</p></div> <p>After the images are converted to webp and are present in wp/wp-content/uploads folder its time to work on DB.</p> <h3 id="_3-check-db-wp-posts-where-your-images-are-located-as-entities-they-are-still-with-their-old-extension-in-this-table"><a href="#_3-check-db-wp-posts-where-your-images-are-located-as-entities-they-are-still-with-their-old-extension-in-this-table" class="header-anchor">#</a> 3. Check DB-&gt;wp_posts, where your images are located as entities. They are still with their old extension in this table.</h3> <p>Ex:</p> <div class="language- extra-class"><pre class="language-text"><code>ID, post_author, post_date, post_date_gmt, post_content, post_title, post_excerpt, post_status, comment_status, ping_status, post_password, post_name, to_ping, pinged, post_modified, post_modified_gmt, post_content_filtered, post_parent, guid, menu_order, post_type, post_mime_type, comment_count

'56', '1', '2023-10-30 08:33:53', '2023-10-30 08:33:53', '', 'Image1.jpg', '', 'inherit', 'open', 'closed', '', 'image1-jpg', '', '', '2023-10-30 08:33:53', '2023-10-30 08:33:53', '', '26', 'https://example.com/wp-content/uploads/2023/10/Image1.jpg', '0', 'attachment', 'image/jpeg', '0'

</code></pre></div><h3 id="_4-update-all-image-entities"><a href="#_4-update-all-image-entities" class="header-anchor">#</a> 4. Update all image entities:</h3> <p>We will have to update the following columns: <strong>post_title</strong>, <strong>post_name</strong>, <strong>guid</strong>, <strong>post_mime_type</strong> and we want them as:</p> <div class="language- extra-class"><pre class="language-text"><code>ID, post_author, post_date, post_date_gmt, post_content, post_title, post_excerpt, post_status, comment_status, ping_status, post_password, post_name, to_ping, pinged, post_modified, post_modified_gmt, post_content_filtered, post_parent, guid, menu_order, post_type, post_mime_type, comment_count

'56', '1', '2023-10-30 08:33:53', '2023-10-30 08:33:53', '', 'Image1.webp', '', 'inherit', 'open', 'closed', '', 'image1-webp', '', '', '2023-10-30 08:33:53', '2023-10-30 08:33:53', '', '26', 'https://example.com/wp-content/uploads/2023/10/Image1.webp', '0', 'attachment', 'image/webp', '0'

</code></pre></div><p>The DB query is fairly simple and ugly, but will do the job.</p> <p>Example Sql query for jpeg to webp(run similar queries for png to webp and gif to webp):</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> wp_posts
<span class="token keyword">SET</span> 
	post_title <span class="token operator">=</span> concat<span class="token punctuation">(</span><span class="token keyword">left</span><span class="token punctuation">(</span>post_title<span class="token punctuation">,</span>length<span class="token punctuation">(</span>post_title<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'webp'</span><span class="token punctuation">)</span>
	post_name <span class="token operator">=</span> concat<span class="token punctuation">(</span><span class="token keyword">left</span><span class="token punctuation">(</span>post_name<span class="token punctuation">,</span>length<span class="token punctuation">(</span>post_name<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'webp'</span><span class="token punctuation">)</span>
	guid <span class="token operator">=</span> concat<span class="token punctuation">(</span><span class="token keyword">left</span><span class="token punctuation">(</span>guid<span class="token punctuation">,</span>length<span class="token punctuation">(</span>guid<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'webp'</span><span class="token punctuation">)</span>
	post_mime_type <span class="token operator">=</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span>post_mime_type<span class="token punctuation">,</span> <span class="token string">'jpeg'</span><span class="token punctuation">,</span> <span class="token string">'webp'</span><span class="token punctuation">)</span>
<span class="token keyword">WHERE</span>
post_parent <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">AND</span>
post_type <span class="token operator">=</span> <span class="token string">'attachment'</span> <span class="token operator">AND</span>
post_title <span class="token operator">LIKE</span> <span class="token string">'%jpg'</span> <span class="token operator">AND</span>
post_name <span class="token operator">LIKE</span> <span class="token string">'%jpg'</span> <span class="token operator">AND</span>
guid <span class="token operator">LIKE</span> <span class="token string">'%jpg'</span> <span class="token operator">AND</span>
post_mime_type <span class="token operator">=</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-also-update-wp-postmeta"><a href="#_5-also-update-wp-postmeta" class="header-anchor">#</a> 5. Also, update wp_postmeta</h3> <p>Each attachment row in wp_posts, have association in wp_postmeta, using wp_postmeta-&gt;post_id column.
You can query postmeta, using post_id:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> wp_postmeta <span class="token keyword">WHERE</span> post_id <span class="token operator">=</span> <span class="token number">56</span>
</code></pre></div><p>You will likely have 3 rows for every attachment.</p> <table><thead><tr><th>meta_key</th></tr></thead> <tbody><tr><td>_wp_attached_file</td></tr> <tr><td>_wp_attachment_metadata</td></tr> <tr><td>_wp_attachment_source</td></tr></tbody></table> <p>We need to change those too.</p> <h3 id="_5-1-wp-attached-file-and-wc-attachment-source"><a href="#_5-1-wp-attached-file-and-wc-attachment-source" class="header-anchor">#</a> 5.1 _wp_attached_file and _wc_attachment_source</h3> <div class="language- extra-class"><pre class="language-text"><code>_wp_attached_file becomes:

2023/10/Image1.webp

_wc_attachment_source becomes:
https://example.com/wp-content/uploads/2023/10/Image1.webp
</code></pre></div><h3 id="_5-2-wp-attachment-metadata"><a href="#_5-2-wp-attachment-metadata" class="header-anchor">#</a> 5.2 _wp_attachment_metadata</h3> <p>_wp_attachment_metadata is a PHP serialized array. We cannot just replace all &quot;jpg&quot; =&gt; &quot;webp&quot; and all &quot;image/jpeg&quot; =&gt; &quot;image/webp&quot;. We will have to also change the length of the new strings. Example:</p> <div class="language- extra-class"><pre class="language-text"><code>s:18:&quot;2023/10/Image1.jpg&quot;
</code></pre></div><p>means that this value is 18 characters long. And if we change this link to webp, it must be:</p> <div class="language- extra-class"><pre class="language-text"><code>s:19:&quot;2023/10/Image1.webp&quot;
</code></pre></div><p>Best way is somehow to unserialize the array, change the values and serialize again. Then, DB save.</p> <p>For this purpose I used this:</p> <p>https://github.com/steelbrain/php-serialize#readme</p> <p>So, the procedure in my head is (i will use Node.js)</p> <div class="language- extra-class"><pre class="language-text"><code>-&gt; Connect to DB

-&gt; Get all attachment id's from wp_posts (``` WHERE post_type = 'attachment' ```)

---&gt; For each id

-----&gt; Get wp_postmeta rows (``` WHERE post_id = ID ```)

-----&gt; Update _wp_attached_file (replace jpg to webp)

-----&gt; Update _wc_attachment_source (replace jpg to webp)

-----&gt; Use php-serialize package to convert _wp_attachment_metadata to JSON object

-----&gt; JSON.serialize the result from the above step

-----&gt; replace all jpg and jpeg to webp

-----&gt; Use php-serialize package .unserialize the replaced string

-----&gt; Save to DB
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">One more time:</p> <p>This method is for research and educational purposes.</p> <p>Its prone to error and not suitable for production websites.</p></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h3 active"><a href="#_1-first-of-all-make-backup-of-the-whole-wp-content-folder-and-the-database" title="1. First of all - make backup of the whole `/wp-content` folder and the database!">1. First of all - make backup of the whole `/wp-content` folder and the database!</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_2-convert-original-images-with-a-tool-of-choice" title="2. Convert original images with a tool of choice.">2. Convert original images with a tool of choice.</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-check-db-wp-posts-where-your-images-are-located-as-entities-they-are-still-with-their-old-extension-in-this-table" title="3. Check DB-&gt;wp_posts, where your images are located as entities. They are still with their old extension in this table.">3. Check DB-&gt;wp_posts, where your images are located as entities. They are still with their old extension in this table.</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-update-all-image-entities" title="4. Update all image entities:">4. Update all image entities:</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_5-also-update-wp-postmeta" title="5. Also, update wp_postmeta">5. Also, update wp_postmeta</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_5-1-wp-attached-file-and-wc-attachment-source" title="5.1 wpattachedfile and wcattachmentsource">5.1 wpattachedfile and wcattachmentsource</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_5-2-wp-attachment-metadata" title="5.2 wpattachment_metadata">5.2 wpattachment_metadata</a></div></div> <div class="to-top-outer"><a href="javascript:;" class="to-top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" size="2x" class="to-top-icon feather feather-chevron-up"><polyline points="18 15 12 9 6 15"></polyline></svg></a></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8><a href="https://www.coodingbox.com/privacy-policy/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8>Privacy Policy</a></li><li class="copyright-item" data-v-3d9deeb8>Copyright © 2022-present Vuepress</li></ul></div></footer></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.29683b52.js" defer></script><script src="/assets/js/10.6cbd15cf.js" defer></script><script src="/assets/js/8.74375672.js" defer></script><script src="/assets/js/21.085a020c.js" defer></script><script src="/assets/js/5.afebdb78.js" defer></script>
  </body>
</html>
